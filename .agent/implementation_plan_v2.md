# å­¦ç”Ÿç»¼åˆç´ è´¨è¯„ä»·ç³»ç»Ÿ - åŠŸèƒ½æ‰©å±•å®æ–½è®¡åˆ’

## ğŸ“‹ éœ€æ±‚æ¦‚è§ˆ

### ä¸€ã€å­¦æœŸä¸å­¦å¹´ç®¡ç†
1. **å­¦æœŸæ•°æ®åŒæ­¥**ï¼šæ¯å­¦æœŸå¼€å§‹æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åŒæ­¥æˆ–æ‰‹åŠ¨è§¦å‘æ•°æ®åˆå§‹åŒ–
2. **å­¦å¹´å‡çº§**ï¼šæ–°å­¦å¹´å¼€å§‹ï¼Œå­¦ç”Ÿè‡ªåŠ¨å‡çº§åˆ°ä¸‹ä¸€å¹´çº§
3. **æ¯•ä¸šå¤„ç†**ï¼šå…­å¹´çº§å­¦ç”Ÿæ¯•ä¸šåæ ‡è®°ä¸ºå·²æ¯•ä¸šçŠ¶æ€
4. **å­¦ç”Ÿè½¬ç­**ï¼šæ”¯æŒå­¦ç”Ÿåœ¨ç­çº§ä¹‹é—´è½¬ç§»

### äºŒã€æˆç»©ç®¡ç†æ¨¡å—ï¼ˆæ–°å¢ï¼‰
1. **è€ƒè¯•ç®¡ç†**ï¼šåˆ›å»ºè€ƒè¯•ã€è®¾ç½®ç§‘ç›®ã€åˆ†æ•°çº¿
2. **æˆç»©å½•å…¥**ï¼šæ•™å¸ˆå½•å…¥å­¦ç”Ÿåˆ†æ•°
3. **æˆç»©ç»Ÿè®¡**ï¼š
   - å­¦ç”Ÿæ€»åˆ†è®¡ç®—
   - ç­çº§æ’åã€å¹´çº§æ’å
   - å•ç§‘ç­çº§æ’åã€å¹´çº§æ’å
   - ç­çº§ä¼˜ç§€ç‡ã€åˆæ ¼ç‡
   - å¹´çº§ä¼˜ç§€ç‡ã€åˆæ ¼ç‡
4. **è¯•å·åˆ†æ**ï¼šæ•™å¸ˆæ’°å†™è¯•å·åˆ†ææŠ¥å‘Š
5. **AIé”™é¢˜åˆ†æ**ï¼šæ‰«æè¯•å·åè‡ªåŠ¨åˆ†æé”™é¢˜å’ŒçŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ

### ä¸‰ã€è€ƒå‹¤ç®¡ç†æ¨¡å—ï¼ˆæ–°å¢ï¼‰
1. **è€ƒå‹¤è®°å½•**ï¼šè®°å½•å­¦ç”Ÿå‡ºå‹¤æƒ…å†µ
2. **è¯·å‡ç±»å‹**ï¼šåŒºåˆ†ç—…å‡ã€äº‹å‡åŠå…·ä½“åŸå› 
3. **è€ƒå‹¤ç»Ÿè®¡**ï¼šç­çº§ã€å¹´çº§è€ƒå‹¤æ±‡æ€»

### å››ã€æ•°æ®å¤§å±å±•ç¤ºï¼ˆæ–°å¢ï¼‰
1. **ç­çº§æ•°æ®çœ‹æ¿**ï¼šå­¦ç”Ÿäººæ•°ã€æˆç»©åˆ†å¸ƒã€è€ƒå‹¤æƒ…å†µ
2. **å¹´çº§æ•°æ®çœ‹æ¿**ï¼šå¹´çº§æ•´ä½“æƒ…å†µå¯¹æ¯”
3. **è€ƒå‹¤æ•°æ®å±•ç¤º**ï¼šå„ç­è€ƒå‹¤å®æ—¶æ•°æ®

### äº”ã€è§’è‰²æƒé™ç»†åŒ–
1. **ç­ä¸»ä»»æƒé™**ï¼š
   - å½•å…¥æœ¬ç­å­¦ç”Ÿä¿¡æ¯
   - æŸ¥çœ‹æœ¬ç­æ‰€æœ‰æ•°æ®
   - ç®¡ç†æœ¬ç­è€ƒå‹¤
2. **ç§‘ä»»æ•™å¸ˆæƒé™**ï¼š
   - å½•å…¥ä»»æ•™ç§‘ç›®æˆç»©
   - æ’°å†™è¯•å·åˆ†æ
   - æŸ¥çœ‹ç›¸å…³æ•°æ®

### å…­ã€æ•°æ®å¯¼å…¥å¯¼å‡º
1. **å­¦ç”Ÿå¯¼å…¥å¯¼å‡º**ï¼šExcelæ ¼å¼
2. **æ•™å¸ˆå¯¼å…¥å¯¼å‡º**ï¼šExcelæ ¼å¼
3. **æˆç»©å¯¼å…¥å¯¼å‡º**ï¼šExcelæ ¼å¼

### ä¸ƒã€ç³»ç»Ÿè®¾ç½®
1. **æ•°æ®åº“å¤‡ä»½**ï¼šæ‰‹åŠ¨/è‡ªåŠ¨å¤‡ä»½
2. **ç³»ç»Ÿå‚æ•°é…ç½®**ï¼šç§‘ç›®è®¾ç½®ã€åˆ†æ•°çº¿è®¾ç½®ç­‰

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. è€ƒè¯•è¡¨ (exams)
```sql
CREATE TABLE exams (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL COMMENT 'è€ƒè¯•åç§°',
    exam_type ENUM('unit', 'midterm', 'final', 'other') DEFAULT 'unit' COMMENT 'è€ƒè¯•ç±»å‹',
    semester_id INT NOT NULL COMMENT 'å­¦æœŸID',
    grade_id INT COMMENT 'å¹´çº§IDï¼ˆå¯é€‰ï¼Œä¸å¡«åˆ™å…¨æ ¡ï¼‰',
    exam_date DATE COMMENT 'è€ƒè¯•æ—¥æœŸ',
    status ENUM('draft', 'active', 'completed') DEFAULT 'draft' COMMENT 'çŠ¶æ€',
    created_by INT COMMENT 'åˆ›å»ºäºº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (semester_id) REFERENCES semesters(id),
    FOREIGN KEY (grade_id) REFERENCES grades(id)
);
```

### 2. è€ƒè¯•ç§‘ç›®è¡¨ (exam_subjects)
```sql
CREATE TABLE exam_subjects (
    id INT PRIMARY KEY AUTO_INCREMENT,
    exam_id INT NOT NULL COMMENT 'è€ƒè¯•ID',
    subject_name VARCHAR(50) NOT NULL COMMENT 'ç§‘ç›®åç§°',
    full_score DECIMAL(5,1) DEFAULT 100 COMMENT 'æ»¡åˆ†',
    pass_score DECIMAL(5,1) DEFAULT 60 COMMENT 'åŠæ ¼åˆ†',
    excellent_score DECIMAL(5,1) DEFAULT 85 COMMENT 'ä¼˜ç§€åˆ†',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    FOREIGN KEY (exam_id) REFERENCES exams(id) ON DELETE CASCADE
);
```

### 3. å­¦ç”Ÿæˆç»©è¡¨ (exam_scores)
```sql
CREATE TABLE exam_scores (
    id INT PRIMARY KEY AUTO_INCREMENT,
    exam_id INT NOT NULL COMMENT 'è€ƒè¯•ID',
    subject_id INT NOT NULL COMMENT 'ç§‘ç›®ID',
    student_id INT NOT NULL COMMENT 'å­¦ç”ŸID',
    score DECIMAL(5,1) COMMENT 'åˆ†æ•°',
    class_rank INT COMMENT 'ç­çº§æ’å',
    grade_rank INT COMMENT 'å¹´çº§æ’å',
    recorded_by INT COMMENT 'å½•å…¥äºº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_exam_subject_student (exam_id, subject_id, student_id),
    FOREIGN KEY (exam_id) REFERENCES exams(id),
    FOREIGN KEY (subject_id) REFERENCES exam_subjects(id),
    FOREIGN KEY (student_id) REFERENCES students(id)
);
```

### 4. å­¦ç”Ÿæ€»åˆ†è¡¨ (exam_totals)
```sql
CREATE TABLE exam_totals (
    id INT PRIMARY KEY AUTO_INCREMENT,
    exam_id INT NOT NULL COMMENT 'è€ƒè¯•ID',
    student_id INT NOT NULL COMMENT 'å­¦ç”ŸID',
    total_score DECIMAL(6,1) COMMENT 'æ€»åˆ†',
    class_rank INT COMMENT 'ç­çº§æ’å',
    grade_rank INT COMMENT 'å¹´çº§æ’å',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_exam_student (exam_id, student_id),
    FOREIGN KEY (exam_id) REFERENCES exams(id),
    FOREIGN KEY (student_id) REFERENCES students(id)
);
```

### 5. è¯•å·åˆ†æè¡¨ (exam_analysis)
```sql
CREATE TABLE exam_analysis (
    id INT PRIMARY KEY AUTO_INCREMENT,
    exam_id INT NOT NULL COMMENT 'è€ƒè¯•ID',
    subject_id INT NOT NULL COMMENT 'ç§‘ç›®ID',
    class_id INT COMMENT 'ç­çº§IDï¼ˆå¯é€‰ï¼‰',
    teacher_id INT COMMENT 'æ•™å¸ˆID',
    analysis_content TEXT COMMENT 'åˆ†æå†…å®¹',
    avg_score DECIMAL(5,1) COMMENT 'å¹³å‡åˆ†',
    max_score DECIMAL(5,1) COMMENT 'æœ€é«˜åˆ†',
    min_score DECIMAL(5,1) COMMENT 'æœ€ä½åˆ†',
    pass_rate DECIMAL(5,2) COMMENT 'åŠæ ¼ç‡',
    excellent_rate DECIMAL(5,2) COMMENT 'ä¼˜ç§€ç‡',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (exam_id) REFERENCES exams(id),
    FOREIGN KEY (subject_id) REFERENCES exam_subjects(id),
    FOREIGN KEY (class_id) REFERENCES classes(id)
);
```

### 6. è€ƒå‹¤è¡¨ (attendance)
```sql
CREATE TABLE attendance (
    id INT PRIMARY KEY AUTO_INCREMENT,
    student_id INT NOT NULL COMMENT 'å­¦ç”ŸID',
    date DATE NOT NULL COMMENT 'æ—¥æœŸ',
    status ENUM('present', 'absent', 'late', 'leave_early', 'sick_leave', 'personal_leave') NOT NULL COMMENT 'çŠ¶æ€',
    leave_type ENUM('sick', 'personal', 'other') COMMENT 'è¯·å‡ç±»å‹',
    reason VARCHAR(500) COMMENT 'åŸå› è¯´æ˜',
    recorded_by INT COMMENT 'è®°å½•äºº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_student_date (student_id, date),
    FOREIGN KEY (student_id) REFERENCES students(id)
);
```

### 7. æ•™å¸ˆä»»è¯¾è¡¨ (teacher_subjects)
```sql
CREATE TABLE teacher_subjects (
    id INT PRIMARY KEY AUTO_INCREMENT,
    teacher_id INT NOT NULL COMMENT 'æ•™å¸ˆID',
    class_id INT NOT NULL COMMENT 'ç­çº§ID',
    subject_name VARCHAR(50) NOT NULL COMMENT 'ä»»æ•™ç§‘ç›®',
    semester_id INT NOT NULL COMMENT 'å­¦æœŸID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_teacher_class_subject (teacher_id, class_id, subject_name, semester_id),
    FOREIGN KEY (teacher_id) REFERENCES teachers(id),
    FOREIGN KEY (class_id) REFERENCES classes(id),
    FOREIGN KEY (semester_id) REFERENCES semesters(id)
);
```

### 8. å­¦ç”Ÿå˜æ›´è®°å½•è¡¨ (student_transfers)
```sql
CREATE TABLE student_transfers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    student_id INT NOT NULL COMMENT 'å­¦ç”ŸID',
    from_class_id INT COMMENT 'åŸç­çº§ID',
    to_class_id INT NOT NULL COMMENT 'ç›®æ ‡ç­çº§ID',
    transfer_date DATE NOT NULL COMMENT 'è½¬ç­æ—¥æœŸ',
    reason VARCHAR(500) COMMENT 'è½¬ç­åŸå› ',
    operated_by INT COMMENT 'æ“ä½œäºº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id),
    FOREIGN KEY (from_class_id) REFERENCES classes(id),
    FOREIGN KEY (to_class_id) REFERENCES classes(id)
);
```

---

## ğŸ“… å®æ–½é˜¶æ®µ

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ•°æ®ç®¡ç†ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰âœ… å·²å®Œæˆ
- [x] 1.1 å­¦ç”Ÿè½¬ç­åŠŸèƒ½ - `POST /api/admin/students/transfer`
- [x] 1.2 å­¦å¹´å‡çº§åŠŸèƒ½ - `POST /api/admin/students/grade-upgrade`
- [x] 1.3 æ¯•ä¸šå¤„ç†åŠŸèƒ½ - é›†æˆåœ¨å­¦å¹´å‡çº§ä¸­
- [x] 1.4 è§’è‰²æƒé™ç»†åŒ–ï¼ˆç­ä¸»ä»»/ç§‘ä»»æ•™å¸ˆï¼‰- `src/web/teacher_role/routes.py`

### ç¬¬äºŒé˜¶æ®µï¼šæˆç»©ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰âœ… å·²å®Œæˆ
- [x] 2.1 è€ƒè¯•ç®¡ç†CRUD - `src/web/exam/routes.py`
- [x] 2.2 æˆç»©å½•å…¥ç•Œé¢ - `frontend/src/pages/Exam/ScoreEntry.tsx`
- [x] 2.3 æˆç»©ç»Ÿè®¡ä¸æ’åè®¡ç®— - `POST /api/exam/calculate-ranks/{exam_id}`
- [x] 2.4 è¯•å·åˆ†æåŠŸèƒ½ - `POST /api/exam/analysis`

### ç¬¬ä¸‰é˜¶æ®µï¼šè€ƒå‹¤ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰âœ… å·²å®Œæˆ
- [x] 3.1 è€ƒå‹¤è®°å½•ç•Œé¢ - `frontend/src/pages/Attendance/AttendanceManagement.tsx`
- [x] 3.2 è¯·å‡ç®¡ç† - æ”¯æŒç—…å‡/äº‹å‡/å…¶ä»–
- [x] 3.3 è€ƒå‹¤ç»Ÿè®¡æŠ¥è¡¨ - `/api/attendance/statistics/*`

### ç¬¬å››é˜¶æ®µï¼šæ•°æ®å¤§å±ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰âœ… å·²å®Œæˆ
- [x] 4.1 ç­çº§æ•°æ®çœ‹æ¿
- [x] 4.2 å¹´çº§æ•°æ®çœ‹æ¿
- [x] 4.3 è€ƒå‹¤æ•°æ®å±•ç¤º - `frontend/src/pages/DataScreen/DataScreen.tsx`

### ç¬¬äº”é˜¶æ®µï¼šå¯¼å…¥å¯¼å‡ºä¸å¤‡ä»½ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰âœ… å·²å®Œæˆ
- [x] 5.1 å­¦ç”Ÿå¯¼å…¥å¯¼å‡º - `/api/import-export/students/export`, `/import`
- [x] 5.2 æ•™å¸ˆå¯¼å…¥å¯¼å‡º - `/api/import-export/teachers/export`
- [x] 5.3 æˆç»©å¯¼å…¥å¯¼å‡º - `/api/import-export/scores/export/{exam_id}`, `/import/{exam_id}`
- [x] 5.4 æ•°æ®åº“å¤‡ä»½åŠŸèƒ½ - `/api/admin/system/backup`

### ç¬¬å…­é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰âœ… å·²å®Œæˆ
- [x] 6.1 AIè¯•å·åˆ†æ - `/api/ai-analysis/generate`
- [x] 6.2 é”™é¢˜çŸ¥è¯†ç‚¹åˆ†æ - `/api/wrong-answer/analyze`

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### åç«¯ API æ–‡ä»¶
| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `src/web/exam/routes.py` | è€ƒè¯•ä¸æˆç»©ç®¡ç† |
| `src/web/exam/__init__.py` | æ¨¡å—åˆå§‹åŒ– |
| `src/web/attendance/routes.py` | è€ƒå‹¤ç®¡ç† |
| `src/web/attendance/__init__.py` | æ¨¡å—åˆå§‹åŒ– |
| `src/web/import_export/routes.py` | æ•°æ®å¯¼å…¥å¯¼å‡º |
| `src/web/import_export/__init__.py` | æ¨¡å—åˆå§‹åŒ– |
| `src/web/ai_analysis/routes.py` | AIè¯•å·åˆ†æ |
| `src/web/ai_analysis/__init__.py` | æ¨¡å—åˆå§‹åŒ– |
| `src/web/teacher_role/routes.py` | æ•™å¸ˆè§’è‰²æƒé™ |
| `src/web/teacher_role/__init__.py` | æ¨¡å—åˆå§‹åŒ– |
| `src/web/wrong_answer/routes.py` | é”™é¢˜åˆ†æ |
| `src/web/wrong_answer/__init__.py` | æ¨¡å—åˆå§‹åŒ– |

### å‰ç«¯é¡µé¢æ–‡ä»¶
| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `frontend/src/pages/DataScreen/DataScreen.tsx` | æ•°æ®å¤§å± |
| `frontend/src/pages/Attendance/AttendanceManagement.tsx` | è€ƒå‹¤ç®¡ç† |
| `frontend/src/pages/Exam/ExamManagement.tsx` | è€ƒè¯•ç®¡ç† |
| `frontend/src/pages/Exam/ScoreEntry.tsx` | æˆç»©å½•å…¥ |
| `frontend/src/pages/Admin/TeacherRoleManagement.tsx` | æ•™å¸ˆæƒé™ç®¡ç† |
| `frontend/src/pages/WrongAnswer/WrongAnswerAnalysis.tsx` | é”™é¢˜åˆ†æ |

### æ•°æ®åº“è¿ç§»æ–‡ä»¶
| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `migrations/v2_feature_expansion.sql` | V2.0æ‰€æœ‰æ–°è¡¨ |
| `migrations/v2.1_wrong_answer.sql` | é”™é¢˜åˆ†æåŠŸèƒ½è¡¨ |

---

## ğŸ¯ å®ŒæˆçŠ¶æ€

- **æ€»è¿›åº¦**: 100% âœ…
- **æ ¸å¿ƒåŠŸèƒ½**: 100% å®Œæˆ
- **V2.1æ–°å¢**: æ•™å¸ˆæƒé™ç®¡ç†ã€é”™é¢˜åˆ†æ

---

*æœ€åæ›´æ–°: 2026-01-22*


